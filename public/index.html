<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Auction Pro Slots</title>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<h2>Đấu giá tài khoản Pro</h2>
<input id="user" placeholder="Tên người dùng" />
<button onclick="createUser()">Tạo user</button>
<p id="balance"></p>
<hr>
<div id="auctions"></div>


<script>
const socket = io();
let currentUser;


function createUser(){
fetch('/api/user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:document.getElementById('user').value})})
.then(r=>r.json()).then(u=>{currentUser=u; updateBalance();});
}


function updateBalance(){
document.getElementById('balance').innerText = 'Số dư: '+currentUser.balance;
}


function load(){
fetch('/api/auctions').then(r=>r.json()).then(list=>{
document.getElementById('auctions').innerHTML = list.map(a=>`
<div>
<b>${a.product}</b><br>
Giá: ${a.currentPrice}<br>
Trạng thái: ${a.status}<br>
<button onclick="bid('${a._id}')">Bid</button>
</div><hr>`).join('');
});
}


function bid(id){
const amount = prompt('Nhập giá bid');
socket.emit('bid',{ auctionId:id, userId:currentUser._id, amount:+amount });
}


socket.on('update', load);
socket.on('ended', load);
load();
</script>
</body>
</html>
